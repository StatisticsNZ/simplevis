---
title: "Plot examples"
author: "David Hodge"
date: "`r Sys.Date()`"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Load dplyr, convert the iris data to a tibble so it prints better.

```{r setup, message = FALSE, warning = FALSE}
library(dplyr)
library(simplevis)

iris <- iris %>% as_tibble() 

iris 
```

Create a point plot of iris sepal width and length.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point(iris, Sepal.Width, Sepal.Length)

```

Or pipe it in, if you prefer.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
iris %>% 
  ggplot_point(Sepal.Width, Sepal.Length)

```

Add titles and adjust the font family and sizes.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
pal <- c("#172a45", "#00b2c3", "#c04124", "#005c75", "#a2c62b", "#702e01", "#ff590d", "#c4c4c7", "#007f39")

ggplot_point(iris, Sepal.Width, Sepal.Length,
               title = "Iris sepal length by width, 2020",
               x_title = "Sepal width (cm)",
               y_title = "Sepal length (cm)",
               caption = "Fisher, 1936",
               pal = pal,
               font_family = "Lato",
               font_size_title = 9,
               font_size_body = 7)

```

Change the wrapping defaults of titles.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point(iris, Sepal.Width, Sepal.Length,
               title = "Iris sepal length by width, 2020", 
               x_title = "Sepal width (cm)",
               y_title = "Sepal length (cm)",
               title_wrap = 10, x_title_wrap = 5, y_title_wrap = 5)
```

Colour the points by the species variable.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point_col(iris, Sepal.Width, Sepal.Length, Species)

```

Facet the points by the species variable.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point_facet(iris, Sepal.Width, Sepal.Length, Species)

```

Turn off the 'zero'-ing of the x and y axis.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point(iris, Sepal.Width, Sepal.Length,
               x_zero = FALSE, y_zero = FALSE)

```

Use a specified colour palette, and increase the size of the dots.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
pal <- c("#172a45", "#00b2c3", "#c04124", "#005c75", "#a2c62b", "#702e01", "#ff590d", "#c4c4c7", "#007f39")

ggplot_point(iris, Sepal.Width, Sepal.Length,
               point_size = 2, pal = pal)

```

Use a specified colour.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point(iris, Sepal.Width, Sepal.Length,
               pal = "#00b2c3")

```

Add some more pretty breaks to the y scale.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point(iris, Sepal.Width, Sepal.Length, 
               y_pretty_n = 10,
               x_pretty_n = 10)

```

Transform the x scale to sqrt and the y scale to log10.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point(iris, Sepal.Width, Sepal.Length,
               x_trans = "sqrt", 
               y_trans = "log10")

```

Put sepal length in terms of metres on the y axis.
Method 1: Change the data to create a new variable.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot_data <- iris %>% 
  mutate(Sepal.Length_m = Sepal.Length / 100)

ggplot_point(plot_data, Sepal.Width, Sepal.Length_m,
               y_title = "Sepal length (m)",
               x_title = "Sepal width (cm)")
```

Method 2: Adjust the y_labels, and keep the data unchanged.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point(iris, Sepal.Width, Sepal.Length,
               y_labels = scales::number_format(accuracy = 0.01, scale = 1/100),
               y_title = "Sepal length (m)",
               x_title = "Sepal width (cm)")
```

Add another ggplot2 layer. It will use your data as default. All other aesthetic variables need to be added.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
ggplot_point(iris, Sepal.Width, Sepal.Length) +
  ggplot2::geom_smooth(ggplot2::aes(Sepal.Width, Sepal.Length))
```

Create a hbar graph.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  mutate(cut = as.character(cut)) %>% 
  group_by(cut) %>%
  summarise(average_price = mean(price)) 
  
ggplot_hbar(plot_data, average_price, cut)

```

Reverse the order of y axis.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
ggplot_hbar(plot_data, average_price, cut,
            y_rev = TRUE)
```

Specify the order by converting to a factor.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
cut_levels <-  c("Fair", "Good", "Very Good", "Premium", "Ideal")

plot_data <- plot_data %>% 
 mutate(cut = factor(cut, levels = cut_levels)) 

ggplot_hbar(plot_data, average_price, cut)


```

Add a $ prefix to y labels and a comma.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
ggplot_hbar(plot_data, average_price, cut, 
            y_rev = TRUE, 
            x_labels = scales::comma_format(prefix = "$"))

```

Balance an x scale between positive and negative values. This is particularly useful for visualising change data.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  mutate(cut = stringr::str_to_sentence(cut)) %>%
  group_by(cut) %>%
  summarise(average_price = mean(price)) %>%
  mutate(average_price = round(average_price / 1000, 1)) %>% 
  mutate(average_price = average_price - 3.75)

ggplot_hbar(plot_data, average_price, cut, x_balance = T)
```

Make a coloured hbar plot.

```{r, message = FALSE, warning = FALSE, fig.height = 4.5, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  group_by(cut, clarity) %>%
  summarise(average_price = mean(price))

ggplot_hbar_col(plot_data, average_price, cut, clarity)

```

Reverse the colouring of the col var bar pieces.

```{r, message = FALSE, warning = FALSE, fig.height = 4.5, fig.width = 6}
ggplot_hbar_col(plot_data, average_price, cut, clarity,
                pal_rev = TRUE)

```

Change the ordering of the coloured bar pieces.

```{r, message = FALSE, warning = FALSE, fig.height = 4.5, fig.width = 6}
ggplot_hbar_col(plot_data, average_price, cut, clarity,
                col_rev = TRUE)

```

Put the coloured bars in a "dodge" position instead of "stack".

```{r, message = FALSE, warning = FALSE, fig.height = 6, fig.width = 6}
ggplot_hbar_col(plot_data, average_price, cut, clarity,
                position = "dodge")

```

Adjust the x labels.

```{r, message = FALSE, warning = FALSE, fig.height = 5, fig.width = 6}
ggplot_hbar_col(plot_data, average_price, cut, clarity,
                x_labels = scales::number_format(scale = 1/1000, accuracy = 1),
                x_title = "Average price ($US thousands)")

```

Make a coloured and facetted plot.

```{r, message = FALSE, warning = FALSE, fig.height = 6, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  mutate(cut = stringr::str_to_sentence(cut)) %>%
  group_by(cut, clarity, color) %>%
  summarise(average_price = mean(price)) %>%
  mutate(average_price_thousands = round(average_price / 1000, 1))

ggplot_hbar_col_facet(plot_data, average_price_thousands, color, clarity, cut,
                              title = "Average diamond price by colour, clarity and cut, 2020", 
                              x_title = "Average price ($US thousands)", 
                              y_title = "Colour")

```

Make a line graph of the storms data.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- storms %>%
  group_by(year) %>%
  summarise(wind = round(mean(wind), 2)) 

ggplot_line(plot_data, year, wind,
  title = "Atlantic storms average maximum wind speed, 1975\u20132015",
  x_title = "Year",
  y_title = "Average maximum wind speed (knots)")

```

Make a plot with a x var of date class.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}

plot_data <- plot_data %>%
  mutate(date = lubridate::ymd(paste0(year, "01-01", sep = "-")))

plot_data

ggplot_line(plot_data, date, wind)

```

Update the x labels.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
ggplot_line(plot_data, date, wind,
            x_labels = scales::date_format(format = "%Y"))

```

Make a vbar graph of the storms data.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
ggplot_vbar(plot_data, year, wind)

```

Turn off the y-zeroing on the line.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
ggplot_line(plot_data, year, wind,
            y_zero = FALSE)

```

Turn off the y-zeroing on the vbar.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
ggplot_vbar(plot_data, year, wind,
            y_zero = FALSE)

```

Make the bar width narrower.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot_data <- storms %>%
  group_by(year) %>%
  summarise(average_wind = round(mean(wind), 2)) 

ggplot_vbar(plot_data, year, average_wind,
  width = 0.33)

```

Add some space between the x axis and the lower break.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot_data <- storms %>%
  group_by(year) %>%
  summarise(average_wind = round(mean(wind), 2)) 

ggplot_vbar(plot_data, year, average_wind,
  y_expand = c(0.05, 0))
```

Sometimes you may want to include a category that is NA in a bar graph, and show that it is NA rather than zero.

```{r}
plot_data <- ggplot2::diamonds %>%
  group_by(cut) %>%
  summarise(average_price = mean(price)) %>%
  mutate(average_price = round(average_price / 1000, 1))  %>% 
  filter(cut != "Very Good") %>% 
  add_row(cut = "Very Good", average_price = NA) %>% # make an NA value for the example
  mutate(cut = factor(cut, levels = c("Fair", "Good", "Very Good", "Premium", "Ideal"))) 

ggplot_hbar(plot_data, average_price, cut, x_na_inf = TRUE)
```


Make a boxplot.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
ggplot_boxplot(iris, Species, Petal.Length)

```

Make a boxplot using the identity stat.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- iris %>%
  group_by(Species) %>%
  summarise(boxplot_stats =
              list(rlang::set_names(
                boxplot.stats(Petal.Length)$stats,
                c('ymin', 'lower', 'middle', 'upper', 'ymax')
              ))) %>%
  tidyr::unnest_wider(boxplot_stats)

plot_data

ggplot_boxplot(plot_data, Species, Petal.Length, stat = "identity")

```

Use quoted variables.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot_data <-  ggplot2::diamonds %>%
  group_by(across("cut")) %>%
  summarise(across("price", ~mean(.))) 

ggplot_hbar(plot_data, !!sym("price"), !!sym("cut"),
                    title = "Average diamond price by cut", 
                    x_title = "Average price ($US thousands)", 
                    y_title = "Cut")

```

Make a non-facetted plot for a mobile device. Note the template shiny apps provide a function to detect what device the user is on and returns a TRUE or FALSE value that you can draw on with isMobile = input$isMobile within a shiny app.

```{r, message = FALSE, warning = FALSE, fig.height = 6, fig.width = 4}
plot_data <- ggplot2::diamonds %>%
  mutate(cut = stringr::str_to_sentence(cut)) %>%
  group_by(cut) %>%
  summarise(average_price = mean(price)) %>%
  mutate(average_price = round(average_price / 1000, 1)) 

ggplot_hbar(plot_data, average_price, cut,
            title = "Average diamond price by cut",
            x_title = "Average price ($US thousands)",
            y_title = "Cut", isMobile = TRUE)
```

Make a ggplotly interactive plot with default tooltip.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot <- ggplot_point(iris, Sepal.Width, Sepal.Length)

plotly::ggplotly(plot)

```

Turn off all plotly buttons other than the camera.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot <- ggplot_point(iris, Sepal.Width, Sepal.Length)

plotly::ggplotly(plot) %>% 
  plotly_camera()

```

Make a ggplotly interactive plot with a different variable.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot <- ggplot_point(iris, Sepal.Width, Sepal.Length, text_var = Petal.Width)

plotly::ggplotly(plot, tooltip = "text")

```

Make a ggplotly interactive plot with custom tooltip that can be created with the mutate_text function. Note that this function will convert snakecase column names to sentence case with underscores changed to spaces. The ggplotly argument tooltip = "text" is required to implement this in combination with the text_var argument in the simplevis function. 

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot_data <- iris %>% 
  mutate_text(c("Species", "Sepal.Width", "Sepal.Length", "Petal.Width"))

plot_data

plot <- ggplot_point(plot_data, Sepal.Width, Sepal.Length, text_var = text)

plotly::ggplotly(plot, tooltip = "text") 

```

The plotly default legend can sometimes not be in the ideal order.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  group_by(cut, clarity) %>%
  summarise(average_price = mean(price)) %>%
  mutate(average_price_thousands = round(average_price / 1000, 1))

plot <- ggplot_hbar_col(plot_data, average_price_thousands, cut, clarity)

plotly::ggplotly(plot)
```

You can change the default order based on a vector of elements.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plotly::ggplotly(plot) %>% 
  plotly_legend_order(c(1, 3, 4, 5, 6, 7, 8, 2))

```

Or you can reverse the order of legend elements.

```{r, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 6}
plotly::ggplotly(plot) %>% 
  plotly_legend_rev()

```
