---
title: "Simplevis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Simplevis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(simplevis)
```

### Purpose 

`simplevis` is a package of wrapper functions to make 'ggplot2' and 'leaflet' visualisation easier and prettier.

### Overview

`simplevis` provides the following types of `ggplot` visualisation:

Graph:

* horizontal bar (`hbar`)
* vertical bar (`vbar`)
* line plot (`line`)
* point plot (`point`)
* boxplot (`boxplot`)

Map:

* sf (`sf`)

Each visualisation type has a family of generally 4 functions.

The function name specifies whether or not a ggplot is to be coloured by a variable, facetted by a variable, or neither or both of these. Colouring by a variable means that different values of a selected variable are to have different colours. Facetting means different values of a selected variable are to have there own mini-graph, and these are to be placed alongside each other.

These 4 functions follow the same structure as the `hbar` functions listed below:

* `ggplot_hbar()`: a horizontal bar graph.
* `ggplot_hbar_col()`: a horizontal bar graph that is coloured by a variable.
* `ggplot_hbar_facet()`: a facetted horizontal bar graph.
* `ggplot_hbar_col_facet()`a facetted horizontal bar graph that is coloured by a variable.

For different types of graph, just replace `hbar` with `line`, `point`, `vbar`, `boxplot` or `sf`. 

In general, required arguments (i.e. specifications) to functions are:

* `data` 
* `x_var` 
* `y_var` 

If you are using a `_col` or `_col_facet` function:

* `col_var`

If you are using a `_facet` or `_col_facet` function:

* `facet_var`

It is always recommended to add a `title`, `x_title` and `y_title` too. 

### Ggplot graphs

#### Graphs that are <i>not</i> coloured by a variable.

Identify the function that you need, then provide the data (aggregated, if necessary) and an x_var and a y_var.

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- ggplot2::diamonds %>% 
  slice_sample(prop = 0.05) %>% 
  as_tibble()

plot_data

ggplot_point(plot_data, carat, price)
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  group_by(cut) %>%
  summarise(average_price = mean(price)) %>%
  mutate(average_price = average_price / 1000) %>%  
  mutate(cut = stringr::str_to_sentence(cut)) %>% 
  as_tibble()

plot_data

ggplot_hbar(plot_data, 
            x_var = average_price, 
            y_var = cut,
            title = "Average diamond price by cut", 
            x_title = "Average price ($US thousands)", 
            y_title = "Cut")
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- storms %>%
  group_by(year) %>%
  summarise(average_wind = mean(wind)) %>% 
  as_tibble()

plot_data

ggplot_vbar(plot_data, 
            x_var = year, 
            y_var = average_wind)
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- storms %>%
  group_by(year) %>%
  summarise(wind = mean(wind)) %>% 
  as_tibble()

plot_data 

ggplot_line(plot_data, 
            x_var = year, 
            y_var = wind)
```

Note the `boxplot` functions transform the data to boxplot statistics by default. 

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- iris %>%
  mutate(Species = stringr::str_to_sentence(Species)) %>% 
  as_tibble()

plot_data

ggplot_boxplot(plot_data, 
               x_var = Species, 
               y_var = Petal.Length)
```

#### Graphs that are coloured by a variable

To colour by a variable, use a `_col` function

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- ggplot2::diamonds %>% 
  slice_sample(prop = 0.05) %>% 
  as_tibble()

plot_data

ggplot_point_col(plot_data, 
                 x_var = carat, 
                 y_var = price, 
                 col_var = color)
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- storms %>%
  mutate(status = stringr::str_to_sentence(status)) %>%
  group_by(year, status) %>%
  summarise(wind = mean(wind)) %>% 
  as_tibble()

ggplot_line_col(plot_data, 
                x_var = year, 
                y_var = wind, 
                col_var = status)
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  group_by(cut, clarity) %>%
  summarise(average_price = mean(price)) %>% 
  mutate(average_price = average_price / 1000) %>% 
  mutate(cut = stringr::str_to_sentence(cut)) %>% 
  as_tibble()

plot_data

ggplot_hbar_col(plot_data, 
                x_var = average_price, 
                y_var = cut, 
                col_var = clarity)
```

#### Graphs that are facetted by a variable

To facet by a variable, use a `_facet` function.

```{r, message = FALSE, warning = FALSE, fig.height = 5, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  mutate(cut = stringr::str_to_sentence(cut)) %>%
  group_by(cut, clarity) %>%
  summarise(average_price = mean(price)) %>%
  mutate(average_price = average_price / 1000) %>% 
  as_tibble()

plot_data

ggplot_hbar_facet(plot_data, 
                  x_var = average_price, 
                  y_var = cut, 
                  facet_var = clarity)
```

#### Graphs that are coloured by a variable and facetted by a variable.

facet by a variable, use a `_col_facet` function.

```{r, message = FALSE, warning = FALSE, fig.height = 5, fig.width = 6}
plot_data <- ggplot2::diamonds %>%
  mutate(cut = stringr::str_to_sentence(cut)) %>%
  group_by(cut, clarity, color) %>%
  summarise(average_price = mean(price)) %>%
  mutate(average_price = round(average_price / 1000, 1))

ggplot_hbar_col_facet(plot_data, 
                      x_var = average_price, 
                      y_var = color, 
                      col_var = clarity, 
                      facet_var = cut)
```

#### Supported variable classes

variable types supported by the different groups of functions are outlined below.

```{r, echo = FALSE}
tibble::tribble(
  ~group, ~x_var, ~y_var, ~col_var, ~facet_var, ~stat,
  "vbar", "numeric, date or categorical", "numeric", "categorical or numeric", "categorical", "identity",
  "hbar", "numeric", "categorical", "categorical or numeric", "categorical", "identity",
  "line", "numeric or date", "numeric", "categorical or numeric", "categorical", "identity",
  "point", "numeric", "numeric", "categorical or numeric", "categorical", "identity",
    "boxplot", "categorical", "numeric", NA, "categorical", "boxplot or identity"
  ) %>% 
  DT::datatable()
```


### ggplot maps

`simplevis` provides simple feature (`sf`) maps (i.e. maps with point, line or polygon features). 

Spatial-temporal array (i.e. `stars`) maps may be supported in future. 

The following functions are available:

* `ggplot_sf`
* `ggplot_sf_col`
* `ggplot_sf_facet`
* `ggplot_sf_col_facet`

These functions work in the same way as the `ggplot` graph functions, but with the following key differences:

* Data must be provided in the format of an `sf` object. 
* Data must be of `POINT`/`MULTIPOINT`, `LINESTRING`/`MULTILINESTRING`, or `POLYGON`/`MULTIPOLYGON` geometry types
* Data can have any coordinate reference system (CRS), but it must be defined
* No `x_var` and `y_var` variables are required, because x_var and y_var are already implicity within the geometry column of an sf object
* There is a `borders` specification, which allows for borders (i.e. country/state/region/coastline) to be added to the map. An example New Zealand sf object (`nz`) has been provided with the package to demonstrate this. 

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 7}
example_sf_point

ggplot_sf(example_sf_point, 
          point_size = 0.25)
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 7}
nz

ggplot_sf(example_sf_point, 
          borders = nz, 
          point_size = 0.25)
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 7}
example_sf_polygon

ggplot_sf_col(example_sf_polygon, 
              col_var = density, 
              borders = nz)
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 7}
ggplot_sf_facet(example_sf_point, 
                facet_var = trend_category, 
                borders = nz, 
                point_size = 0.5)
```

```{r, message = FALSE, warning = FALSE, fig.height = 3, fig.width = 7}
ggplot_sf_col_facet(example_sf_point, 
                    col_var = trend_category, 
                    facet_var = trend_category,
                    borders = nz, 
                    point_size = 0.5, 
                    pal = c("#4575B4", "#D3D3D3", "#D73027"),
                    title = "Site trends, 1990\u201317")
```

### leaflet maps

`simplevis` also provides `sf` `leaflet` maps.

These work in the same way as the `ggplot` map functions, but with no borders arguments. 

Arguments have been aligned with simplevis ggplot wrapping functions (e.g. point_size = radius, line_size = weight, alpha = fillOpacity)

Spatial-temporal array (i.e. `stars`) maps may be supported in future. 

```{r, eval=FALSE}
leaflet_sf(data = example_sf_polygon)
```

```{r, eval=FALSE}
leaflet_sf_col(example_sf_polygon, 
               col_var = density)
```